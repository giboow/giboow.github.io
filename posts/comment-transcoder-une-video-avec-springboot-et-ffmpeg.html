<!DOCTYPE html><html class="has-navbar-fixed-top"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="keywords" content="Video,Transcoder,SpringBoot,FFMpeg,Java"/><meta name="title" content="Comment construire un transcodeur vidéo avec SpringBoot et FFMPEG !"/><meta property="og:title" content="Comment construire un transcodeur vidéo avec SpringBoot et FFMPEG !"/><meta property="og:image" content="/static/images/post/proxy-transcoder-ffmpeg/main.jpg"/><meta name="twitter:image" content="/static/images/post/proxy-transcoder-ffmpeg/main.jpg"/><meta property="og:url" content=""/><title>Comment construire un transcodeur vidéo avec SpringBoot et FFMPEG !</title><meta name="next-head-count" content="9"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-dracula.min.css"/><link rel="shortcut icon" href="/static/images/icons/favicon.ico"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/7070765780599759.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7070765780599759.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-01df828e572375b9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-30cffe79720cc685.js" defer=""></script><script src="/_next/static/chunks/a9a7754c-05c682ba86311bbe.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-c2ffd8d428a8879e.js" defer=""></script><script src="/_next/static/chunks/543-f2ed9e3420d49453.js" defer=""></script><script src="/_next/static/chunks/890-ac39a76621f37c4f.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-d7cf3671e1f60cca.js" defer=""></script><script src="/_next/static/1648222878596/_buildManifest.js" defer=""></script><script src="/_next/static/1648222878596/_ssgManifest.js" defer=""></script><script src="/_next/static/1648222878596/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css?family=Roboto">@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxM.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="custom_class"><div id="__next" data-reactroot=""><div><div><nav class="navbar is-boxed is-fixed-top"><div class="navbar-brand"><a class="navbar-item " style="font-family:Roboto;font-weight:bold;font-size:1.5em;color:cadetblue" href="/">GiBoOw</a><div class="navbar-burger burger"><span></span><span></span><span></span></div></div><div class="navbar-start"><a class="navbar-item is-tab is-hidden-mobile" href="/">Accueil</a><a class="navbar-item is-tab is-hidden-mobile" href="/posts">Posts</a><a class="navbar-item is-tab is-hidden-mobile" href="/a-propos">A propos</a></div><div class="navbar-end navbar-menu"><a class="navbar-item is-tab is-hidden-tablet" href="/">Accueil</a><a class="navbar-item is-tab is-hidden-tablet" href="/posts">Posts</a><a class="navbar-item is-tab is-hidden-tablet" href="/a-propos">A propos</a></div></nav></div><div><div class="container main-container mt-1"><nav class="breadcrumb is-hidden-touch" aria-label="breadcrumbs"><ul><li><a href="/">Accueil</a></li><li><a href="/posts">Posts</a></li><li class="is-active"><a href="#">Comment construire un transcodeur vidéo avec SpringBoot et FFMPEG !</a></li></ul></nav></div><article><header class="article-header mt-1"><section class="hero is-secondary hero-background has-background is-blogpost"><img class="hero-background is-transparent" src="/static/images/post/proxy-transcoder-ffmpeg/main.jpg"/><div class="hero-body"><div class="container"><div class="title">Comment construire un transcodeur vidéo avec SpringBoot et FFMPEG !</div><div class="metadata"><div class="image is-24x24 is-pulled-left mr-2"><img src="https://github.com/giboow.png?size=28" class="is-rounded" alt="author"/></div><time class="is-left" dateTime="2021-10-12T00:00:00Z">12 octobre 2021</time></div></div></div></section></header><div class="container"><section class="section"><div class="content"><p>J'ai récemment commencé à travailler sur un système de caméras de surveillance et je souhaite pouvoir afficher les vidéos collectées sur des pages Web.
À première vue, cela semblait très facile, mais je me suis vite rendu compte que je devais me creuser la tête!</p>
<h1>Comment cela doit fonctionner?</h1>
<p>La caméra est connectée à un NVR (Numeric Video recorder) qui possède une API permettant de récupérer les informations de configuration et le flux vidéo. En cherchant un peu sur le Web (Oui la documentation est difficile d'accès..), je découvre que le protocole de communication utilisé par le NVR est le RTSP (Real-Time Streaming Protocol). C'est là que je rencontre le principal problème ! Comment utiliser ce protocole dans une page HTML qui ne le supporte pas ? Ma solution est d'utiliser un serveur qui permet de transcoder la vidéo dans un format plus connu (MP4) et un protocole ultra standard (Http). Cela me permettra également de cacher les identifiants d'accès à la caméra en utilisant mon serveur comme un proxy.</p>
<p><img src="https://giboow.fr/static/images/post/proxy-transcoder-ffmpeg/graph-ffmpeg-transcoder.png" alt="Graph it should work"></p>
<h1>Alors comment on fait ça?</h1>
<p>Un excellent outil bien connu pour faire de la conversion vidéo est <a href="https://www.ffmpeg.org/">FFMPeg</a>, donc je commence à regarder comment je peux l'utiliser pour convertir RSTP. Je trouve rapidement une ligne de commande qui fonctionne :</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">ffmpeg -y -loglevel level+info -n -re -acodec pcm_s16le -rtsp_transport tcp -i rtsp://user:passwd@192.168.1.200:554/ISAPI/Streaming/channels/101/live -vcodec copy -af <span class="token assign-left variable">asetrate</span><span class="token operator">=</span><span class="token number">22050</span> -acodec aac -b:a 96k -nostdin myvideo.mp4
</code></pre></div>
<p>Alors comment faire un proxy avec SpringBoot ? C'est très simple en fait, il suffit d'utiliser l'objet <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/StreamingResponseBody.html">StreamingResponseBody</a>. Cela permet de renvoyer un traitement asynchrone de la requête, où l'application peut écrire directement sur le flux de sortie de la réponse sans bloquer le reste de mon API.</p>
<p>Enfin, il me suffit d'utiliser FFMPEG dans mon contrôleur pour envoyer le flux via mon API. J'aurais pu utiliser " Runtime.getRuntime().exec(" ffmpeg...) " mais je n'arrivais pas à trouver comment obtenir mon flux. Heureusement, j'ai trouvé une bibliothèque magique <a href="https://github.com/kokorin/Jaffree">Jaffree</a> : "Jaffree stands for JAva FFmpeg and FFprobe FREE command line wrapper. Jaffree supports programmatic video production and consumption (with transparency)"</p>
<h1>La solution</h1>
<p>Voici la solution finale et comment relayer un flux vidéo provenant d'une caméra HikVision afin que le format soit utilisable par une page HTML.</p>
<div class="remark-highlight"><pre class="language-java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>kokorin<span class="token punctuation">.</span>jaffree<span class="token punctuation">.</span></span><span class="token class-name">StreamType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>kokorin<span class="token punctuation">.</span>jaffree<span class="token punctuation">.</span>ffmpeg<span class="token punctuation">.</span></span><span class="token class-name">FFmpeg</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>kokorin<span class="token punctuation">.</span>jaffree<span class="token punctuation">.</span>ffmpeg<span class="token punctuation">.</span></span><span class="token class-name">PipeOutput</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/video"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Log4j2</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VideoController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/live.mp4"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&#x3C;</span><span class="token class-name">StreamingResponseBody</span><span class="token punctuation">></span></span> <span class="token function">livestream</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> tipperId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> rtspUrl <span class="token operator">=</span> <span class="token string">"rtsp://user:passwd@192.168.1.200:554/ISAPI/Streaming/channels/101/live"</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_OCTET_STREAM<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>os <span class="token operator">-></span> <span class="token punctuation">{</span>
                    <span class="token class-name">FFmpeg</span><span class="token punctuation">.</span><span class="token function">atPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token string">"-re"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addArguments</span><span class="token punctuation">(</span><span class="token string">"-acodec"</span><span class="token punctuation">,</span> <span class="token string">"pcm_s16le"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addArguments</span><span class="token punctuation">(</span><span class="token string">"-rtsp_transport"</span><span class="token punctuation">,</span> <span class="token string">"tcp"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addArguments</span><span class="token punctuation">(</span><span class="token string">"-i"</span><span class="token punctuation">,</span> $rtspUrl<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addArguments</span><span class="token punctuation">(</span><span class="token string">"-vcodec"</span><span class="token punctuation">,</span> <span class="token string">"copy"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addArguments</span><span class="token punctuation">(</span><span class="token string">"-af"</span><span class="token punctuation">,</span> <span class="token string">"asetrate=22050"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addArguments</span><span class="token punctuation">(</span><span class="token string">"-acodec"</span><span class="token punctuation">,</span> <span class="token string">"aac"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addArguments</span><span class="token punctuation">(</span><span class="token string">"-b:a"</span><span class="token punctuation">,</span> <span class="token string">"96k"</span> <span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addOutput</span><span class="token punctuation">(</span><span class="token class-name">PipeOutput</span><span class="token punctuation">.</span><span class="token function">pumpTo</span><span class="token punctuation">(</span>os<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">disableStream</span><span class="token punctuation">(</span><span class="token class-name">StreamType</span><span class="token punctuation">.</span>AUDIO<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">disableStream</span><span class="token punctuation">(</span><span class="token class-name">StreamType</span><span class="token punctuation">.</span>SUBTITLE<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">disableStream</span><span class="token punctuation">(</span><span class="token class-name">StreamType</span><span class="token punctuation">.</span>DATA<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">setFrameCount</span><span class="token punctuation">(</span><span class="token class-name">StreamType</span><span class="token punctuation">.</span>VIDEO<span class="token punctuation">,</span> <span class="token number">100L</span><span class="token punctuation">)</span>
                                     <span class="token comment">//1 frame every 10 seconds</span>
                                    <span class="token punctuation">.</span><span class="token function">setFrameRate</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">setDuration</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">setFormat</span><span class="token punctuation">(</span><span class="token string">"ismv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">addArgument</span><span class="token punctuation">(</span><span class="token string">"-nostdin"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Vous devrez également modifier la configuration de votre application SpringBoot (fichier application.properties) pour augmenter le délai d'attente pour les requêtes asynchrones.</p>
<div class="remark-highlight"><pre class="language-html"><code class="language-html">spring.mvc.async.request-timeout = 3600000
</code></pre></div>
<p>Il vous suffit d'appeler votre API sur la page web :</p>
<div class="remark-highlight"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>video</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auto<span class="token punctuation">"</span></span> <span class="token attr-name">controls</span> <span class="token attr-name">autoplay</span> <span class="token attr-name">muted</span> <span class="token attr-name">loop</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>event?.video<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>source</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost:8080/video/live.mp4<span class="token punctuation">"</span></span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video/mp4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    Sorry, your browser doesn't support embedded videos.
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>video</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
</code></pre></div>
<p>Et voici le résultat :</p>
<p><img src="https://giboow.fr/static/images/post/proxy-transcoder-ffmpeg/result-ffmpeg-transcoder.png" alt="Final result"></p>
<p>Facile non?</p>
<p><a href="https://dev.to/giboow/how-to-build-a-video-transcoder-with-springboot-and-ffmpeg-n7p">Retrouvez l'article anglais sur dev.to</a></p>
</div></section></div></article></div><footer class="footer"><div class="container"><div class="columns is-vcentered"><div class="column is-offset-1-desktop is-4 is-6-mobile"><div class="content is-large"><div class="columns is-mobile"><div class="column"><a title="Twitter" class="icon" href="https://twitter.com/giboow"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a></div><div class="column"><a title="LinkedIn" class="icon" href="https://www.linkedin.com/in/pgibert/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div><div class="column"><a title="Github" class="icon" target="_blank" href="https://github.com/giboow/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div><div class="column"><a title="Contactez moi" class="icon" href="/contact"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="weixin" class="svg-inline--fa fa-weixin fa-w-18 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"></path></svg></a></div></div></div></div><div class="column is-offset-4-desktop is-4-desktop"><div class="content is-small">© <!-- -->2022<!-- --> - Made with ♥ By <a href="https://twitter.com/giboow">Giboow</a></div></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"comment-transcoder-une-video-avec-springboot-et-ffmpeg","contentHtml":"\u003cp\u003eJ'ai récemment commencé à travailler sur un système de caméras de surveillance et je souhaite pouvoir afficher les vidéos collectées sur des pages Web.\nÀ première vue, cela semblait très facile, mais je me suis vite rendu compte que je devais me creuser la tête!\u003c/p\u003e\n\u003ch1\u003eComment cela doit fonctionner?\u003c/h1\u003e\n\u003cp\u003eLa caméra est connectée à un NVR (Numeric Video recorder) qui possède une API permettant de récupérer les informations de configuration et le flux vidéo. En cherchant un peu sur le Web (Oui la documentation est difficile d'accès..), je découvre que le protocole de communication utilisé par le NVR est le RTSP (Real-Time Streaming Protocol). C'est là que je rencontre le principal problème ! Comment utiliser ce protocole dans une page HTML qui ne le supporte pas ? Ma solution est d'utiliser un serveur qui permet de transcoder la vidéo dans un format plus connu (MP4) et un protocole ultra standard (Http). Cela me permettra également de cacher les identifiants d'accès à la caméra en utilisant mon serveur comme un proxy.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://giboow.fr/static/images/post/proxy-transcoder-ffmpeg/graph-ffmpeg-transcoder.png\" alt=\"Graph it should work\"\u003e\u003c/p\u003e\n\u003ch1\u003eAlors comment on fait ça?\u003c/h1\u003e\n\u003cp\u003eUn excellent outil bien connu pour faire de la conversion vidéo est \u003ca href=\"https://www.ffmpeg.org/\"\u003eFFMPeg\u003c/a\u003e, donc je commence à regarder comment je peux l'utiliser pour convertir RSTP. Je trouve rapidement une ligne de commande qui fonctionne :\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003effmpeg -y -loglevel level+info -n -re -acodec pcm_s16le -rtsp_transport tcp -i rtsp://user:passwd@192.168.1.200:554/ISAPI/Streaming/channels/101/live -vcodec copy -af \u003cspan class=\"token assign-left variable\"\u003easetrate\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e22050\u003c/span\u003e -acodec aac -b:a 96k -nostdin myvideo.mp4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAlors comment faire un proxy avec SpringBoot ? C'est très simple en fait, il suffit d'utiliser l'objet \u003ca href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/StreamingResponseBody.html\"\u003eStreamingResponseBody\u003c/a\u003e. Cela permet de renvoyer un traitement asynchrone de la requête, où l'application peut écrire directement sur le flux de sortie de la réponse sans bloquer le reste de mon API.\u003c/p\u003e\n\u003cp\u003eEnfin, il me suffit d'utiliser FFMPEG dans mon contrôleur pour envoyer le flux via mon API. J'aurais pu utiliser \" Runtime.getRuntime().exec(\" ffmpeg...) \" mais je n'arrivais pas à trouver comment obtenir mon flux. Heureusement, j'ai trouvé une bibliothèque magique \u003ca href=\"https://github.com/kokorin/Jaffree\"\u003eJaffree\u003c/a\u003e : \"Jaffree stands for JAva FFmpeg and FFprobe FREE command line wrapper. Jaffree supports programmatic video production and consumption (with transparency)\"\u003c/p\u003e\n\u003ch1\u003eLa solution\u003c/h1\u003e\n\u003cp\u003eVoici la solution finale et comment relayer un flux vidéo provenant d'une caméra HikVision afin que le format soit utilisable par une page HTML.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token namespace\"\u003ecom\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egithub\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekokorin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejaffree\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eStreamType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token namespace\"\u003ecom\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egithub\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekokorin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejaffree\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003effmpeg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eFFmpeg\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token namespace\"\u003ecom\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egithub\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekokorin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejaffree\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003effmpeg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token class-name\"\u003ePipeOutput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token annotation punctuation\"\u003e@RestController\u003c/span\u003e\n\u003cspan class=\"token annotation punctuation\"\u003e@RequestMapping\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/video\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token annotation punctuation\"\u003e@Log4j2\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVideoController\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token annotation punctuation\"\u003e@GetMapping\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evalue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/live.mp4\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token annotation punctuation\"\u003e@ResponseBody\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eResponseEntity\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eStreamingResponseBody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003elivestream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token annotation punctuation\"\u003e@PathVariable\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eLong\u003c/span\u003e tipperId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethrows\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eException\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e rtspUrl \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"rtsp://user:passwd@192.168.1.200:554/ISAPI/Streaming/channels/101/live\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eResponseEntity\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eok\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003econtentType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eMediaType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eAPPLICATION_OCTET_STREAM\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eos \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"token class-name\"\u003eFFmpeg\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eatPath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddArgument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"-re\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddArguments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"-acodec\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"pcm_s16le\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddArguments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"-rtsp_transport\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"tcp\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddArguments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"-i\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e $rtspUrl\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddArguments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"-vcodec\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"copy\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddArguments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"-af\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"asetrate=22050\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddArguments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"-acodec\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"aac\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddArguments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"-b:a\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"96k\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddOutput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003ePipeOutput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epumpTo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003edisableStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eStreamType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eAUDIO\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003edisableStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eStreamType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSUBTITLE\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003edisableStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eStreamType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDATA\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetFrameCount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eStreamType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVIDEO\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e100L\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                     \u003cspan class=\"token comment\"\u003e//1 frame every 10 seconds\u003c/span\u003e\n                                    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetFrameRate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetDuration\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTimeUnit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eHOURS\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetFormat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"ismv\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddArgument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"-nostdin\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eexecute\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eVous devrez également modifier la configuration de votre application SpringBoot (fichier application.properties) pour augmenter le délai d'attente pour les requêtes asynchrones.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003espring.mvc.async.request-timeout = 3600000\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIl vous suffit d'appeler votre API sur la page web :\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eclass\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003evideo\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003evideo\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ewidth\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e100%\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eheight\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eauto\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003econtrols\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eautoplay\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003emuted\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eloop\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003e*ngIf\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eevent?.video\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003esource\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ehttp://localhost:8080/video/live.mp4\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n            \u003cspan class=\"token attr-name\"\u003etype\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003evideo/mp4\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    Sorry, your browser doesn't support embedded videos.\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003evideo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eEt voici le résultat :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://giboow.fr/static/images/post/proxy-transcoder-ffmpeg/result-ffmpeg-transcoder.png\" alt=\"Final result\"\u003e\u003c/p\u003e\n\u003cp\u003eFacile non?\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://dev.to/giboow/how-to-build-a-video-transcoder-with-springboot-and-ffmpeg-n7p\"\u003eRetrouvez l'article anglais sur dev.to\u003c/a\u003e\u003c/p\u003e\n","author":"giboow","title":"Comment construire un transcodeur vidéo avec SpringBoot et FFMPEG !","date":"2021-10-12","keywords":["Video","Transcoder","SpringBoot","FFMpeg","Java"],"image":"/static/images/post/proxy-transcoder-ffmpeg/main.jpg"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"comment-transcoder-une-video-avec-springboot-et-ffmpeg"},"buildId":"1648222878596","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>